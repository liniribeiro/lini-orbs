version: 2.1

setup: true

orbs:
  path-filtering: circleci/path-filtering@0.1.3
  orb-tools: circleci/orb-tools@11.2.0
  shellcheck: circleci/shellcheck@3.1


jobs:
  validate-orb:
    working_directory: ~/xanana
    docker:
      - image: cimg/python:3.9
    description: Validate an orb
    parameters:
      path:
        type: string
        description: The path to the orb
    steps:
      - checkout
      - run:
          name: Adding Permission
          command: |
            sudo chown -R circleci:circleci /usr/local/
      - run:
          name: Install circleci
          command: |
            curl https://raw.githubusercontent.com/CircleCI-Public/circleci-cli/master/install.sh --fail --show-error | bash
      - run:
          name: Validate orb
          command: |
            circleci orb validate << parameters.path >>/orb.yml

      - save_cache:
          key: repo-{{.Environment.CIRCLE_SHA1}}
          paths:
             - "/usr/local/bin"

  publish-orb:
    working_directory: ~/listicle
    docker:
      - image: cimg/python:3.9
    parameters:
      path:
        type: string
        description: The path to the orb
    steps:
      - checkout
      - restore_cache:
          keys:
            - repo-{{.Environment.CIRCLE_SHA1}}
      - run:
          name: publish dev orb
          command: |
             circleci orb publish << parameters.path >>/orb.yml launchpotato/<< parameters.path >>@dev:first

workflows:
  hello-world-p:
    jobs:
      - validate-orb:
          path: hello-world-p
      - publish-orb:
          path: hello-world-p
